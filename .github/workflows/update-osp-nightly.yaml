name: update-osp-nightly
run-name: Check for OSP nightly and create a PR
on: workflow_dispatch
  # schedule:
  #  - cron: '0 2 * * *'
jobs:
  update-osp-nightly:
    runs-on: ubuntu-latest
    steps:
      - name: Check for new OSP nightly build
        run: |
          tag="v4.14-candidate"
          inspected=$(skopeo inspect docker://quay.io/openshift-pipeline/openshift-pipelines-pipelines-operator-bundle-container-index:$tag)
          created=$(date +%s -d $(echo "$inspected" | jq -r '.Created'))
          printf "created: %s\n" $created
          _24hours_ago=$(($(date +%s)-1950400))
          if [ $created -lt $_24hours_ago ]; then
            echo "DEBUG: No new nightly build"
            exit 0
          fi
          echo "DEBUG: New nightly build found"
          digest=$(echo "$inspected" | jq -r '.Digest')
          printf "digest: %s\n" $digest
          # - uses: actions/checkout@v4

          # - name: Create Pull Request
          # uses: peter-evans/create-pull-request@v5
